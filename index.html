<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MSVitaSync Dashboard</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }
    body {
      background: linear-gradient(to right, #dff6ff, #e9faff);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 950px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      padding: 24px 32px;
    }
    h1 {
      text-align: center;
      color: #0077b6;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f0f8ff;
      color: #0077b6;
    }
    .status {
      padding: 6px 12px;
      border-radius: 12px;
      color: white;
      font-size: 13px;
    }
    .online {
      background: #28a745;
    }
    .offline {
      background: #dc3545;
    }
    .value {
      font-weight: 600;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Thi·∫øt b·ªã theo d√µi s·ª©c kh·ªèe - MSVitaSync</h1>
    <table>
      <thead>
        <tr>
          <th>Thi·∫øt b·ªã</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Gi√° tr·ªã ƒëo</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Nhi·ªát ƒë·ªô</td>
          <td><span id="status-temp" class="status offline">Ngo·∫°i tuy·∫øn</span></td>
          <td class="value" id="val-temp">--</td>
        </tr>
        <tr>
          <td>SpO‚ÇÇ</td>
          <td><span id="status-spo2" class="status offline">Ngo·∫°i tuy·∫øn</span></td>
          <td class="value" id="val-spo2">--</td>
        </tr>
        <tr>
          <td>Nh·ªãp tim</td>
          <td><span id="status-hr" class="status offline">Ngo·∫°i tuy·∫øn</span></td>
          <td class="value" id="val-hr">--</td>
        </tr>
        <tr>
          <td>Huy·∫øt √°p</td>
          <td><span id="status-bp" class="status offline">Ngo·∫°i tuy·∫øn</span></td>
          <td class="value" id="val-bp">--</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    // --- K·∫øt n·ªëi d·ªØ li·ªáu th·∫≠t t·ª´ ERA ---
    const eraWidget = new EraWidget({
        token: "1ced9c99-1cd3-45f6-98a1-82ea28141f85",  // ‚ö†Ô∏è Thay token c·ªßa b·∫°n
        deviceId: "15794"                               // ‚ö†Ô∏è Thay ID thi·∫øt b·ªã c·ªßa b·∫°n
      });
      eraWidget.init({
        needRealtimeConfigs: true,
        needHistoryConfigs: false,
        needActions: false,
        maxRealtimeConfigsCount: 8,
      });
    if (window.ERaWidget) {
      console.log("‚úÖ ƒê√£ k·∫øt n·ªëi v·ªõi ERA!");
      window.ERaWidget.on("sensor/data", (topic, payload) => {
        try {
          const data = JSON.parse(payload);
          console.log("üì© D·ªØ li·ªáu nh·∫≠n t·ª´ ERA:", data);

          // --- c·∫≠p nh·∫≠t c√°c gi√° tr·ªã ---
          if (data.temp) {
            document.getElementById("val-temp").textContent = data.temp + " ¬∞C";
            setOnline("temp");
          }
          if (data.spo2) {
            document.getElementById("val-spo2").textContent = data.spo2 + " %";
            setOnline("spo2");
          }
          if (data.hr) {
            document.getElementById("val-hr").textContent = data.hr + " bpm";
            setOnline("hr");
          }
          if (data.bp) {
            document.getElementById("val-bp").textContent = data.bp;
            setOnline("bp");
          }
        } catch (e) {
          console.error("‚ùå L·ªói ƒë·ªçc d·ªØ li·ªáu ERA:", e);
        }
      });
    } else {
      console.error("‚ùå Kh√¥ng c√≥ ERA widget! H√£y m·ªü file n√†y trong ERA Dashboard.");
    }

    // --- ƒë·ªïi tr·∫°ng th√°i thi·∫øt b·ªã ---
    function setOnline(id) {
      const el = document.getElementById(`status-${id}`);
      el.textContent = "Tr·ª±c tuy·∫øn";
      el.classList.remove("offline");
      el.classList.add("online");
    }
  </script>
</body>
</html>

