<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ERA IoT - Dashboard S·ª©c kh·ªèe</title>
  <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
  <style>
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: linear-gradient(135deg, #74b9ff, #a29bfe);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      width: 360px;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      transition: 0.3s;
    }
    h2 { text-align: center; color: #2d3436; }
    input, select {
      width: 100%; padding: 12px; margin: 8px 0;
      border: 1px solid #dcdde1; border-radius: 10px; outline: none;
      transition: 0.3s;
    }
    input:focus, select:focus { border-color: #0984e3; }
    button {
      width: 100%; padding: 12px; background: #0984e3;
      color: white; border: none; border-radius: 10px;
      cursor: pointer; font-size: 15px; transition: 0.3s;
    }
    button:hover { background: #74b9ff; }
    .switch { text-align: center; margin-top: 10px; }
    .switch span { color: #0984e3; cursor: pointer; }

    /* Dashboard */
    .dashboard {
      display: none;
      text-align: center;
      color: #2d3436;
      width: 420px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 25px 10px;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: 0.3s;
    }
    .card:hover { transform: translateY(-5px); }
    .icon { font-size: 35px; margin-bottom: 10px; }
    .label { font-weight: 600; font-size: 14px; color: #636e72; }
    .value { font-size: 22px; font-weight: bold; color: #2d3436; margin-top: 5px; }
  </style>
</head>
<body>

  <!-- ƒêƒÉng nh·∫≠p -->
  <div class="container" id="loginBox">
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <input type="text" id="loginName" placeholder="H·ªç v√† t√™n" />
    <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u" />
    <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
    <div class="switch">
      Ch∆∞a c√≥ t√†i kho·∫£n? <span onclick="toggleForm()">ƒêƒÉng k√Ω</span>
    </div>
  </div>

  <!-- ƒêƒÉng k√Ω -->
  <div class="container" id="registerBox" style="display:none;">
    <h2>ƒêƒÉng k√Ω</h2>
    <input type="text" id="name" placeholder="H·ªç v√† t√™n" />
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" />
    <input type="number" id="age" placeholder="Tu·ªïi" />
    <select id="gender">
      <option value="">Gi·ªõi t√≠nh</option>
      <option value="Nam">Nam</option>
      <option value="N·ªØ">N·ªØ</option>
      <option value="Kh√°c">Kh√°c</option>
    </select>
    <input type="number" id="weight" placeholder="C√¢n n·∫∑ng (kg)" />
    <input type="number" id="height" placeholder="Chi·ªÅu cao (cm)" />
    <input type="text" id="history" placeholder="L·ªãch s·ª≠ b·ªánh l√Ω" />
    <input type="text" id="eyes" placeholder="ƒê·ªô c·∫≠n (n·∫øu c√≥)" />
    <button onclick="register()">ƒêƒÉng k√Ω</button>
    <div class="switch">
      ƒê√£ c√≥ t√†i kho·∫£n? <span onclick="toggleForm()">ƒêƒÉng nh·∫≠p</span>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="container dashboard" id="dashboard">
    <h2>Ch·ªâ s·ªë s·ª©c kh·ªèe (ERA IoT)</h2>
    <div class="stats">
      <div class="card"><div class="icon">üå°Ô∏è</div><div class="label">Nhi·ªát ƒë·ªô</div><div class="value" id="temp">-- ¬∞C</div></div>
      <div class="card"><div class="icon">‚ù§Ô∏è</div><div class="label">Nh·ªãp tim</div><div class="value" id="heart">-- bpm</div></div>
      <div class="card"><div class="icon">üíß</div><div class="label">SpO‚ÇÇ</div><div class="value" id="spo2">-- %</div></div>
      <div class="card"><div class="icon">ü©∏</div><div class="label">Huy·∫øt √°p</div><div class="value" id="bp">-- mmHg</div></div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    function toggleForm() {
      const login = document.getElementById("loginBox");
      const register = document.getElementById("registerBox");
      login.style.display = login.style.display === "none" ? "block" : "none";
      register.style.display = register.style.display === "none" ? "block" : "none";
    }

    function register() {
      const name = document.getElementById("name").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!name || !password) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!");
      const user = {
        name,
        password,
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value,
        weight: document.getElementById("weight").value,
        height: document.getElementById("height").value,
        history: document.getElementById("history").value,
        eyes: document.getElementById("eyes").value
      };
      localStorage.setItem("user_" + name, JSON.stringify(user));
      alert("ƒêƒÉng k√Ω th√†nh c√¥ng!");
      toggleForm();
    }

    function login() {
      const name = document.getElementById("loginName").value.trim();
      const password = document.getElementById("loginPassword").value.trim();
      const data = localStorage.getItem("user_" + name);
      if (!data) return alert("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng!");
      const user = JSON.parse(data);
      if (user.password !== password) return alert("Sai m·∫≠t kh·∫©u!");
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      connectERA();
    }

    // =========== ERA IoT ===========
    function connectERA() {
      const temp = document.getElementById("temp");
      const heart = document.getElementById("heart");
      const spo2 = document.getElementById("spo2");
      const bp = document.getElementById("bp");

      const era = new EraWidget({
        token: "1ced9c99-1cd3-45f6-98a1-82ea28141f85", // üîë Thay b·∫±ng token ERA c·ªßa b·∫°n
        deviceId: "15794" // üîß ID thi·∫øt b·ªã th·∫≠t c·ªßa b·∫°n
      });

      era.init({
        needRealtimeConfigs: true,
        onConfiguration: (cfg) => {
          console.log("Config:", cfg);
        },
        onValues: (values) => {
          const data = Object.values(values);
          data.forEach(v => {
            if (v.name.toLowerCase().includes("temp")) temp.textContent = `${v.value} ¬∞C`;
            else if (v.name.toLowerCase().includes("spo2")) spo2.textContent = `${v.value} %`;
            else if (v.name.toLowerCase().includes("heart")) heart.textContent = `${v.value} bpm`;
            else if (v.name.toLowerCase().includes("bp")) bp.textContent = `${v.value} mmHg`;
          });
          console.log("Realtime:", values);
        }
      });
    }
  </script>
</body>
</html>
